<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>REST with Node.js</title>
    <!-- build:css styles/styles.css-->
    <link rel="stylesheet" type="text/css" href="bower_components/prism/themes/prism-tomorrow.css">
    <link rel="stylesheet" type="text/css" href="styles/main.css">
    <!-- endbuild-->
  </head>
  <body>
    <div id="folder-structure">
      <h5>Open Files</h5>
      <h5>Folders</h5>
      <ul>noderest
        <li>server.js</li>
        <li class="package-json">package.json </li>
        <li class="node-modules">
          <ul>node_modules 
            <li>express</li>
          </ul>
        </li>
        <li class="routes-js">routes.js</li>
        <li class="controllers">
          <ul>controllers
            <li>musicians.js</li>
          </ul>
        </li>
        <li class="models">
          <ul>models
            <li>musician.js</li>
          </ul>
        </li>
      </ul>
    </div>
    <div id="terminal">
      <ul id="terminal-list"></ul>
    </div>
    <article>
      <section data-bespoke-state="title">
        <h1>REST with Node.js</h1>
      </section>
      <section data-bespoke-state="intro">
        <h2>Mental Map</h2>
        <h3>REST + Node.js?</h3>
      </section>
      <section data-bespoke-state="intro">
        <h2>REST + PHP</h2>
        <ul>
          <li class="bullet"></li>
          <li class="bullet">Apache</li>
          <li class="bullet">.php controllers</li>
          <li class="bullet">.htaccess pretty urls</li>
          <li class="bullet">Content-Type JSON Headers</li>
          <li class="bullet">MySQLi </li>
        </ul>
      </section>
      <section data-bespoke-state="intro">
        <h2>REST + Nodejs</h2>
        <ul>
          <li class="bullet"></li>
          <li class="bullet">Node.js</li>
          <li class="bullet">Express</li>
          <li class="bullet">JavaScript modules</li>
          <li class="bullet">Routes</li>
          <li class="bullet">Mongo</li>
        </ul>
      </section>
      <section data-bespoke-state="node">
        <h2>Node.js</h2>
        <h3>server.js</h3>
        <hr>
        <pre><code class="language-javascript">var http = require('http');
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello New York\n');
}).listen(3001, '127.0.0.1');
console.log('Server running at http://127.0.0.1:3001/');
</code></pre>
      </section>
      <section id="npm-install" data-bespoke-state="node">
        <h2>Node.js </h2>
        <h3>Terminal command</h3>
        <hr>
        <pre><code class="language-javascript">$ cd noderest/
$ node server.js</code></pre>
        <ul class="for-terminal">
          <li>$ cd noderest/</li>
          <li>$ node server.js</li>
        </ul>
      </section>
      <section id="npm-install" data-bespoke-state="node">
        <h2>Node.js </h2>
        <h3>start node</h3>
        <ul class="for-terminal">
          <li>Server running at http://127.0.0.1:3001/</li>
        </ul>
      </section>
      <section data-bespoke-state="node">
        <h2>Node.js</h2>
        <h3>server started</h3>
        <hr><img src="img/browser-node.gif" height="282" width="394">
      </section>
      <section id="package-json" data-bespoke-state="express">
        <h2>Add Dependencies</h2>
        <h3>Express: App Framework for Node</h3>
        <h3>package.json</h3>
        <hr>
        <pre><code class="language-javascript">{
    "name": "Node REST Demo",
    "description": "Demo REST API with Node",
    "version": "0.0.1",
    "private": true,
    "dependencies": {
        "express": "3.x"
    }
}
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Install Dependencies</h2>
        <h3>Express is only dependency</h3>
        <hr>
        <pre><code class="language-javascript">$ npm install</code></pre>
        <ul class="for-terminal">
          <li>$ npm install</li>
        </ul>
      </section>
      <section data-bespoke-state="express">
        <h2>Express</h2>
        <h3>installing</h3>
        <ul class="for-terminal">
          <li><span class="synt-hi-node">npm</span>&nbsp;<span class="synt-hi-http">http</span>&nbsp;<span class="synt-hi-prot">GET </span><span>https://registry.npmjs.org/express</span></li>
          <li><span class="synt-hi-node">npm</span>&nbsp;<span class="synt-hi-http">http</span>&nbsp;<span class="synt-hi-prot">200 </span><span>https://registry.npmjs.org/express</span></li>
          <li>express@3.5.2 node_modules/express</li>
          <li>├── methods@0.1.0</li>
          <li>├── merge-descriptors@0.0.2</li>
          <li>├── cookie@0.1.2</li>
          <li>├── cookie-signature@1.0.3</li>
          <li>├── range-parser@1.0.0</li>
          <li>├── debug@0.8.1</li>
          <li>├── fresh@0.2.2</li>
          <li>├── buffer-crc32@0.2.1</li>
          <li>├── mkdirp@0.4.0</li>
          <li>├── commander@1.3.2 (keypress@0.1.0)</li>
          <li>├── send@0.3.0 (debug@0.8.0, mime@1.2.11)</li>
          <li>└── connect@2.14.5 (response-time@1.0.0, pause@0.0.1, connect-timeout@1.0.0, method-override@1.0.0, qs@0.6.6, basic-auth-connect@1.0.0, vhost@1.0.0, bytes@0.3.0, raw-body@1.1.4, static-favicon@1.0.2, errorhandler@1.0.0, setimmediate@1.0.1, serve-static@1.1.0, morgan@1.0.0, csurf@1.1.0, cookie-parser@1.0.1, compression@1.0.0, express-session@1.0.2, serve-index@1.0.1, multiparty@2.2.0)</li>
          <li>$</li>
        </ul>
      </section>
      <section data-bespoke-state="express">
        <h2>Add Express</h2>
        <h3>server.js</h3>
        <hr>
        <pre><code class="language-javascript">var express = require('express');

var app = express();

app.get('/', function(req, res) {
    res.send('Hello Seattle\n');
});

app.listen(3001);
console.log('Listening on port 3001...');
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Express</h2>
        <h3>restart Node with Express</h3>
        <pre><code class="language-javascript">CTRL+C</code></pre>
        <ul class="for-terminal">
          <li>$</li>
          <li>$ node server.js</li>
          <li>Listening on port 3001... </li>
        </ul>
      </section>
      <section data-bespoke-state="express">
        <h2>Node and Express</h2>
        <h3>serving different headers</h3><img src="img/browser-express.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="express">
        <h2>Routes</h2>
        <hr>
        <pre><code class="language-javascript">app.get('/path', function(req, res) {
    res.send('Return JSON or HTML View');
});
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Request</h2>
        <h3>req</h3>
        <hr>
        <pre><code class="language-javascript">app.get('/musician/:name', function(req, res) {

    // Get /musician/Matt
    console.log(req.params.name)
    // => Matt
    
    res.send('{"id": 1,"name":"Matt", 
      "band":"BBQ Brawlers"}');
});
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Response</h2>
        <h3>res</h3>
        <hr>
        <pre><code class="language-javascript">res.send({ some: 'json' });
res.send("html for Maximum Pain's web page");
res.send(404, 'No musicians here');
res.send(500, { error: 'you blew it' });
res.send(200);
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>HTTP verbs</h2>
        <h3>routes.js</h3>
        <hr>
        <pre><code class="language-javascript">module.exports = function(app){
  var musicians = require('./controllers/musicians');
  
  app.get('/musicians', musicians.findAll);
  app.get('/musicians/:id', musicians.findById);
  app.post('/musicians', musicians.add);
  app.put('/musicians/:id', musicians.update);
  app.delete('/musicians/:id', musicians.delete);
}
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>JS Modules</h2>
        <h3>controllers/musicians.js</h3>
        <hr>
        <pre><code class="language-javascript">exports.findAll = function(req, res){
  res.send([{
    "id": 1,
    "name": "Max",
    "band": "Maximum Pain",
    "instrument": "guitar"
  }]);
};
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Import Routes and JS Modules</h2>
        <h3>server.js</h3>
        <hr>
        <pre><code class="language-javascript">var express = require('express');

var app = express();             

require('routes')(app);

app.listen(3001);
console.log("Jammin\' on port 3001...");
</code></pre>
      </section>
      <section data-bespoke-state="express">
        <h2>Node.js</h2>
        <h3>restart node server</h3>
        <pre><code class="language-javascript">CTRL+C</code></pre>
        <ul class="for-terminal">
          <li>$</li>
          <li>$ node server.js</li>
          <li>Jammin' on port 3001... </li>
        </ul>
      </section>
      <section data-bespoke-state="express">
        <h2>REST GET</h2>
        <h3>/musicians</h3><img src="img/browser-musicians.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="express">
        <h2>Mongo DB</h2>
        <h3>controllers/musicians.js</h3>
        <hr>
        <pre><code class="language-javascript">var mongoose = require('mongoose'),
Musician = mongoose.model('Musician');

exports.findAll = function(req, res){
  Musician.find({},function(err, results) {
    return res.send(results);
  });
};
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>MongoDB</h2>
        <h3>start mongo</h3>
        <hr>
        <pre><code class="language-javascript">$ mongod</code></pre>
        <ul class="for-terminal">
          <li>$ mongod</li>
          <li>&nbsp;</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Mongoose.js</h2>
        <h3>install Mongo Node model framework</h3>
        <hr>
        <pre><code class="language-javascript">$ npm install mongoose --save-dev</code></pre>
        <ul class="for-terminal">
          <li>$ npm install mongoose --save-dev</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Mongoose.js</h2>
        <h3>installing</h3>
        <ul class="for-terminal">
          <li><span class="synt-hi-node">npm</span>&nbsp;<span class="synt-hi-http">http</span>&nbsp;<span class="synt-hi-prot">GET </span><span>https://registry.npmjs.org/mongoose</span></li>
          <li><span class="synt-hi-node">npm</span>&nbsp;<span class="synt-hi-http">http</span>&nbsp;<span class="synt-hi-prot">200 </span><span>https://registry.npmjs.org/mongoose</span></li>
          <li>> kerberos@0.0.3 install /Applications/MAMP/htdocs/noderest_project/node_modules/mongoose/node_modules/mongodb/node_modules/kerberos</li>
          <li>> (node-gyp rebuild 2> builderror.log) || (exit 0)</li>
          <li></li>
          <li>CXX(target) Release/obj.target/kerberos/lib/kerberos.o</li>
          <li>SOLINK_MODULE(target) Release/bson.node: Finished</li>
          <li>mongoose@3.8.8 node_modules/mongoose</li>
          <li>├── regexp-clone@0.0.1</li>
          <li>├── muri@0.3.1</li>
          <li>├── sliced@0.0.5</li>
          <li>├── hooks@0.2.1</li>
          <li>├── mpath@0.1.1</li>
          <li>├── mpromise@0.4.3</li>
          <li>├── ms@0.1.0</li>
          <li>├── mquery@0.5.3 (debug@0.7.4)</li>
          <li>└── mongodb@1.3.23 (kerberos@0.0.3, bson@0.2.5)</li>
          <li>$</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Update Server</h2>
        <h3>server.js</h3>
        <pre><code class="language-javascript">var express = require('express'),
mongoose = require('mongoose'),
fs = require('fs');

var mongoUri = 'mongodb://localhost/noderest_project'; 
mongoose.connect(mongoUri);
var db = mongoose.connection;
db.on('error', function () {
  throw new Error('unable to connect to database at ' + mongoUri);
});

var app = express();

app.configure(function(){
  app.use(express.bodyParser());
});

require('./models/musicians')
require('./routes')(app);

app.listen(3001);
console.log('Listening on port 3001...');
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Model Schema</h2>
        <h3>models/musician.js</h3>
        <pre><code class="language-javascript">var mongoose = require('mongoose'),
Schema = mongoose.Schema;

var MusicianSchema = new Schema({
  name: String,
  band: String,
  instrument: String
});

mongoose.model('Musician', MusicianSchema);
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Mongo</h2>
        <h3>restart Node with Mongo</h3>
        <pre><code class="language-javascript">CTRL+C</code></pre>
        <ul class="for-terminal">
          <li>$ node server.js</li>
          <li>Listening on port 3001...</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>REST GET</h2>
        <h3>/musicians</h3><img src="img/browser-no-musicians.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Mongo Data Import</h2>
        <h3>add route to routes.js</h3>
        <pre><code class="language-javascript">app.get('/import', musicians.import);  
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Mongo Data Import</h2>
        <h3>add method to controller/musicians.js</h3>
        <pre><code class="language-javascript">exports.import = function(req, res){
  Musician.create(
    { "name": "Ben", "band": "DJ Code Red", "instrument": "Reason" },
    { "name": "Mike D.","band": "Kingston Kats", "instrument": "drums" },
    { "name": "Eric", "band": "Eric", "instrument": "piano" },
    { "name": "Paul", "band": "The Eyeliner", "instrument": "guitar" }   
  , function (err) {                
    if (err) return console.log(err); 
    return res.send(202);
  });
};
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Node.js</h2>
        <h3>restart node server</h3>
        <pre><code class="language-javascript">CTRL+C</code></pre>
        <ul class="for-terminal">
          <li>$ node server.js</li>
          <li>Listening on port 3001...</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Run Import</h2>
        <h3>/import</h3><img src="img/browser-import.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Data Imported</h2>
        <h3>/musicians</h3><img src="img/browser-data.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Route GET to findAll</h2>
        <h3>app.get('/musicians', musicians.findAll); </h3>
        <hr>
        <pre><code class="language-javascript">exports.findAll = function(req, res){
  Musician.find({},function(err, results) {
    return res.send(results);
  });
};    
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Route GET to findById</h2>
        <h3>app.get('/musicians/:id', musicians.findById);</h3>
        <hr>
        <pre><code class="language-javascript">exports.findById = function(req, res){
  var id = req.params.id;
  Musician.findOne({'_id':id},function(err, result) {
    return res.send(result);
  });
};
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>GET by Id</h2>
        <h3>/musicians/:id</h3><img src="img/browser-by-id.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Route PUT to update</h2>
        <h3>app.put('/musicians/:id', musicians.update);</h3>
        <hr>
        <pre><code class="language-javascript">exports.update = function(req, res) {
  var id = req.params.id;
  var updates = req.body;
  
  Musician.update({'_id':id}, req.body, 
    function (err, numberAffected) {
      if (err) return console.log(err);
      console.log('Updated %d musicians', numberAffected);
  });
}   
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>PUT</h2>
        <h3>use cURL to test</h3>
        <hr>
        <pre><code class="language-javascript">$ curl -i -X PUT -H 'Content-Type: application/json' 
  -d '{"band": "BBQ Brawlers"}' 
  http://localhost:3001/musicians/535fe13ac688500000c2b28b</code></pre>
        <ul class="for-terminal">
          <li>curl -i -X PUT -H 'Content-Type: application/json' -d '{"instrument": "voice"}' http://localhost:3001/musicians/535ea3fc29b5c50000c685db</li>
          <li>HTTP/1.1 200 OK</li>
          <li>X-Powered-By: Express</li>
          <li>Content-Type: application/json; charset=utf-8</li>
          <li>Content-Length: 88</li>
          <li>Date: Mon, 28 Apr 2014 22:27:04 GMT</li>
          <li>Connection: keep-alive</li>
          <li>&nbsp;</li>
          <li>{</li>
          <li>   "updatedExisting": true,</li>
          <li>   "n": 1,</li>
          <li>   "connectionId": 330,</li>
          <li>   "err": null,</li>
          <li>   "ok": 1</li>
          <li> }</li>
          <li>Updated 1 musicians</li>
          <li>$ </li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Updated</h2>
        <h3>/musicians/:id</h3><img src="img/browser-put.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Route POST to add</h2>
        <h3>app.post('/musicians', musicians.add);</h3>
        <hr>
        <pre><code class="language-javascript">exports.add = function(req, res) {
  Musician.create(req.body, function (err, musician) {
    if (err) return console.log(err); 
    return res.send(musician);
  });
}   
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>POST</h2>
        <h3>use cURL to test</h3>
        <hr>
        <pre><code class="language-javascript">$ curl -i -X POST -H 'Content-Type: application/json' -d 
  '{"name": "Joe", "band": "Abita Boys",
  "instrument":"voice"}' 
  http://localhost:3001/musicians </code></pre>
        <ul class="for-terminal">
          <li>curl -i -X POST -H 'Content-Type: application/json' -d '{"name": "Joe", "band": "Abita Boys", "instrument":"voice"}' http://localhost:3001/musicians </li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Added</h2>
        <h3>/musicians</h3><img src="img/browser-post.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="mongo">
        <h2>Route DELETE to delete</h2>
        <h3>app.delete('/musicians/:id', musicians.delete);</h3>
        <hr>
        <pre><code class="language-javascript">exports.delete = function(req, res){
  var id = req.params.id;
  Musician.remove({'_id':id},function(result) {
    return res.send(result);
  });
};
</code></pre>
      </section>
      <section data-bespoke-state="mongo">
        <h2>DELETE</h2>
        <h3>use cURL to test</h3>
        <hr>
        <pre><code class="language-javascript">$ curl -i -X DELETE 
  http://localhost:3001/musicians/535feac1cc539500000a209f</code></pre>
        <ul class="for-terminal">
          <li>curl -i -X DELETE http://localhost:3001/musicians/535fe565c688500000c2b28d</li>
          <li>HTTP/1.1 200 OK</li>
          <li>X-Powered-By: Express</li>
          <li>Content-Length: 0</li>
          <li>Date: Tue, 29 Apr 2014 18:10:25 GMT</li>
          <li>Connection: keep-alive</li>
        </ul>
      </section>
      <section data-bespoke-state="mongo">
        <h2>Deleted</h2>
        <h3>/musicians</h3><img src="img/browser-delete.gif" height="282" width="394">
      </section>
      <section data-bespoke-state="title">
        <h2>Thanks</h2>
      </section>
      <section data-bespoke-state="title">
        <h2>Reference</h2><a href="http://expressjs.com/4x/api.html">Express API Reference</a><a href="http://mongoosejs.com/docs/api.html">Mongoose.js API docs</a><a href="http://coenraets.org/blog/2012/10/creating-a-rest-api-using-node-js-express-and-mongodb/">Creating a REST API using Node.js, Express, and MongoDB</a><a href="https://github.com/markdalgleish/bespoke.js">Bespoke.js</a>
      </section>
    </article>
    <script src="//use.typekit.net/eag8wad.js"></script>
    <!-- build:js scripts/scripts.js-->
    <script src="bower_components/bespoke.js/dist/bespoke.min.js"></script>
    <script src="bower_components/bespoke-keys/dist/bespoke-keys.min.js"></script>
    <script src="bower_components/bespoke-touch/dist/bespoke-touch.min.js"></script>
    <script src="bower_components/bespoke-bullets/dist/bespoke-bullets.min.js"></script>
    <script src="bower_components/bespoke-scale/dist/bespoke-scale.min.js"></script>
    <script src="bower_components/bespoke-hash/dist/bespoke-hash.min.js"></script>
    <script src="bower_components/bespoke-progress/dist/bespoke-progress.min.js"></script>
    <script src="bower_components/bespoke-state/dist/bespoke-state.min.js"></script>
    <script src="bower_components/bespoke-forms/dist/bespoke-forms.min.js"></script>
    <script src="bower_components/prism/prism.js"></script>
    <script src="scripts/main.js"></script>
    <!-- endbuild-->
  </body>
</html>